# 推送消息模式分析建议方案

本方案旨在为 Teams, Lark, Telegram, Slack 四个平台提供统一、直观且具备跳转功能的推送消息模板建议。

## 用户审核需求

> [!IMPORTANT]
> 1. **统一性**：由于各平台消息卡片语法不同（Teams: Adaptive Cards, Lark: Interactive Cards, Slack: Block Kit），我们将定义一套统一的中间数据格式，再转换至各平台原生格式。
> 2. **直观性**：信息展示将遵循“谁-时间-条件-规则”的结构。
> 3. **操作性**：每个消息都会包含一个显眼的按钮，指向后台管理系统的具体页面。

## 详细方案设计

### 1. 消息结构定义 (Source of Truth)

为了保证统一，我们建议后台推送数据包含以下核心字段：
- `alert_title`: 告警标题 (例如: 余额告警)
- `rule_name`: 触发规则的名称
- `trigger_info`: 触发的条件详情 (例如: 当前余额 $500 < 预警值 $1000)
- `trigger_by`: 触发对象 (例如: 账号 ID 或 用户名)
- `timestamp`: 发生时间 (格式化后的 ISO 时间)
- `target_url`: 跳转链接

### 2. 各平台显示建议

#### A. Microsoft Teams (Adaptive Cards)
- **卡片类型**：使用 `AdaptiveCard` v1.4+。
- **布局**：顶部使用彩色标题（根据告警等级变化），中间使用 `FactSet` 展示结构化信息，底部放置 `Action.OpenUrl` 按钮。
- **视觉**：支持分栏显示，看起来非常专业。

#### B. Lark/飞书 (Interactive Cards)
- **卡片类型**：使用“消息卡片”。
- **布局**：使用标题栏（支持背景颜色枚举），内容区使用 `div` 或 `column_set`。
- **视觉**：飞书的卡片最为美观，支持多种预定义的主题颜色。

#### C. Slack (Block Kit)
- **块类型**：`header` 块作为标题，`section` 块配合 `fields` 数组展示 key-value 对，`actions` 块放置按钮。
- **视觉**：简洁明了，支持 Markdown 增强描述。

#### D. Telegram (HTML + Inline Keyboard)
- **格式**：使用 HTML 模式进行加粗、等宽字体美化。
- **按钮**：使用 `inline_keyboard` 实现消息下方的跳转按钮。
- **视觉**：虽然不支持复杂布局，但通过加粗和表情符号可以做到非常醒目。

### 3. 跳转按钮设计

- **按钮名称**：`查看详情` / `View Details` 或 `立即处理` / `Take Action`。
- **链接逻辑**：`https://admin-url.com/rules/edit/12345`。

---

## 验证计划

由于本次为设计方案分析，无需代码验证。后续若开始实施，将按照以下步骤验证：

### 自动化测试
- 针对转换函数编写 Unit Test，确保输入同一套 Data，输出符合各平台要求的 JSON 格式。

### 手动验证
- 使用各平台提供的开发者集成测试工具 (Webhooks/Applets) 发送测试消息，并在手机端和桌面端确认显示效果。
