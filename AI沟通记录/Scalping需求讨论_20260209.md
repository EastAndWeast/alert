# Scalping 需求讨论记录

**时间**: 2026-02-09 11:34  
**主题**: Scalping (刷单监控) 功能需求分析

---

## USER 输入

用户提出了 Scalping 的需求，具体内容包括：

### 客户原始需求
1. **核心功能**: 当持仓时间（平仓时间 - 开仓时间）小于所设定的参数时，发出警报

2. **过滤器参数**:
   - 产品
   - 手数
   - 开仓的DealInUSD（MT5）/ OpenTradeInUSD（MT4）
   - ProfitInUSD

### 关注点
1. 是否可以满足客户需求？
2. 是否存在过度设计？

---

## ASSISTANT 分析

### 结论概要
- ✅ **完全可以满足客户需求**
- ❌ **无过度设计**，所有功能点均为必要或合理扩展

### 当前系统实现

系统已完整实现客户要求的所有功能：

| 客户需求 | 系统参数 | 状态 |
|---------|---------|------|
| 持仓时间阈值 | `duration_threshold` | ✅ 已支持 |
| 产品过滤 | `symbol_filter` | ✅ 已支持 |
| 手数过滤 | `lot_min` | ✅ 已支持 |
| 开仓价值过滤 | `usd_value_min` | ✅ 已支持 |
| 盈利过滤 | `profit_usd_min` | ✅ 已支持 |

#### 额外功能
系统还提供了客户未明确要求但非常实用的功能：
- `include_loss`: 是否包含亏损交易（可选择只监控盈利交易）

### 核心分析要点

#### 1. 功能完整性
所有客户要求的过滤器均已实现，且系统能够自动处理MT4/MT5平台的字段差异。

#### 2. 设计合理性
- 所有参数都有明确的业务用途
- `include_loss`虽然客户未明确要求，但属于合理扩展
- 无冗余或不必要的功能

#### 3. 平台兼容性
系统自动区分MT4和MT5：
- MT5使用: `DealInUSD`
- MT4使用: `OpenTradeInUSD`
- 前端统一显示为"最小USD价值"

### 待用户确认事项

> [!IMPORTANT]
> 请确认以下问题：

1. **`include_loss`（包含亏损交易）功能**
   - 问题: 是否需要提供"只监控盈利交易"的选项？
   - 建议: 保留该功能，默认`false`（只监控盈利）

2. **`profit_usd_min`的语义**
   - 问题: 是指"盈利≥该值"还是"盈亏绝对值≥该值"？
   - 当前实现: 使用绝对值（盈利200或亏损200都告警）
   - 建议: 确认客户的实际需求

3. **多个过滤器的逻辑**
   - 当前: 全部为AND关系（所有条件都必须满足）
   - 建议: 确认是否符合需求

### 配置界面

当前配置界面已包含所有必要参数：
```
持仓时间: [180] 秒 *
最小手数: [0.1]
最小USD价值: [10000]
最小获利: [200] USD
☐ 包含亏损交易
监控品种: [选择器]
```

### UI优化建议

建议添加以下帮助提示：

1. **持仓时间字段**:
   ```
   💡 提示：当交易的持仓时间小于此阈值时触发告警。
   例如：设置180秒，则所有持仓不足3分钟就平仓的交易都会触发告警。
   ```

2. **最小USD价值字段**:
   ```
   ℹ️ 说明：对应MT5的DealInUSD和MT4的OpenTradeInUSD字段。
   系统会自动根据平台类型匹配正确的字段。
   ```

---

## 下一步行动

待用户确认上述3个问题后：
1. 如需调整，更新相关逻辑
2. 优化UI提示文案（如上述建议）
3. 完善文档说明

---

**状态**: 等待用户确认补充问题
