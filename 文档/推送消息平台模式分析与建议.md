# 推送消息平台模式分析与建议

## 1. 背景与目标
为了提升告警系统的用户体验，我们需要在 Teams, Lark (飞书), Telegram, Slack 四个主流办公/通讯平台上实现推送消息的规范化。
- **统一性**：跨平台体验一致。
- **直观性**：一眼识破风险点。
- **可点击性**：一键触达管理后台。

## 2. 核心信息模板建议
我们建议采用以下标准的“四段式”结构：

| 模块 | 包含属性 | 示例内容 |
| :--- | :--- | :--- |
| **标题 (Header)** | 告警等级 + 告警类别 | 🔴 紧急告警：大额交易异常 |
| **主体 (Primary)** | 谁 (Object), 规则 (Rule) | 账号: 12345678, 触发规则: Large Trader (USD) |
| **详情 (Details)** | 条件触发值 (Metrics) | 实际金额: $50,000 > 阈值: $10,000 |
| **脚注 (Footer)** | 时间 (Time) | 触发时间: 2026-02-07 09:45:00 (UTC+8) |

## 3. 各平台渲染效果示意 (设计构想)

### Microsoft Teams
> Teams 使用 Adaptive Cards，最像一个小型的交互式网页。

```json
// 结构构思
{
  "type": "AdaptiveCard",
  "body": [
    {"type": "TextBlock", "text": "🔴 余额告警", "weight": "Bolder", "size": "Medium"},
    {"type": "FactSet", "facts": [
      {"title": "账号", "value": "12345678"},
      {"title": "条件", "value": "$500 < $1000"},
      {"title": "时间", "value": "09:45:00"}
    ]}
  ],
  "actions": [{"type": "Action.OpenUrl", "title": "进入后台查看", "url": "..."}]
}
```

### Lark (飞书)
> 飞书的互动卡片最为美观，支持多种预定义的 Header 颜色。

- **配色建议**：🔴 紧急 (red), 🟡 预警 (yellow), 🔵 通告 (blue)。
- **布局建议**：使用 `column_set` 将“账号”和“规则名”并排显示，节省空间。

### Slack
> Slack Block Kit 风格简洁。

- **建议**：使用 `section` 块配合左右两列的 `fields`。左边显示“谁/规则”，右边显示“具体数值”。

### Telegram
> TG 主要依靠 HTML 标签。

- **建议**：
  <b>🔴 余额告警</b>
  <code>账号: 12345678</code>
  <code>规则: Low Balance</code>
  ----------------
  触发时间: 2026-02-07
  [查看详情按钮]

## 4. 跳转功能实现建议
- **Deep Link**：建议由后端生成带有 `alert_id` 的短链接。
- **认证**：点击链接后，若用户未登录后台，需先重定向至登录页，登录后自动跳转回该告警详情页。

## 5. 后续计划
1. **定义 Schema**：确定通用的告警数据格式。
2. **开发转换器**：编写各平台的渲染引擎。
3. **集成 Webhook/Bot**：各平台创建对应的机器人。
