# 所有规则触发值显示优化方案

**创建时间**: 2026-02-09 12:34

---

## 一、规则类型汇总

系统共10种规则类型,当前触发值显示情况:

| 规则类型 | 当前显示 | 数据示例 | 是否需要优化 |
|---------|---------|---------|-------------|
| **large_trade_lots** | `8.5 手` | `trigger_value: 8.5, details: {direction: 'BUY'}` | ✅ 需要 |
| **large_trade_usd** | `$125,000` | `trigger_value: 125000, details: {lots: 2.5}` | ✅ 需要 |
| **liquidity_trade** | `15.5 手` | `trigger_value: 15.5, details: {order_count: 8, direction: 'BUY'}` | ✅ 需要 |
| **scalping** | `35s \| 2.0手 \| +$850` | `trigger_value: 35, details: {lots: 2.0, profit_usd: 850}` | ✅ 已优化 |
| **exposure_alert** | `$12,500,000` | `trigger_value: 12500000, details: {direction: 'LONG'}` | ✅ 需要 |
| **pricing_volatility** | `45s` | `trigger_value: 45, details: {alert_subtype: 'PRICING'}` | ✅ 需要 |
| **nop_limit** | `6,200` | `trigger_value: 6200, details: {net_position: 62, direction: 'LONG'}` | ✅ 需要 |
| **watch_list** | `5.0 手` | `trigger_value: 5.0, details: {action: 'OPEN_TRADE', direction: 'BUY'}` | ✅ 需要 |
| **reverse_positions** | `3s` | `trigger_value: 3, details: {close_direction: 'BUY', open_direction: 'SELL'}` | ✅ 需要 |
| **deposit_withdrawal** | `$50,000` | `trigger_value: 50000, details: {type: 'DEPOSIT'}` | ✅ 需要 |

---

## 二、优化方案设计

### 1. large_trade_lots (大额交易-手数)

**当前**: `8.5 手`
**优化**: `8.5手 | BUY`

**数据结构**:
```javascript
{
  trigger_value: 8.5,          // 手数
  details: { direction: 'BUY', threshold: 5.0 }
}
```

**显示逻辑**: 手数 + 方向

---

### 2. large_trade_usd (大额交易-USD)

**当前**: `$125,000`
**优化**: `$125,000 | 2.5手`

**数据结构**:
```javascript
{
  trigger_value: 125000,       // USD价值
  details: { lots: 2.5, account_currency: 'USD' }
}
```

**显示逻辑**: USD价值 + 手数

---

### 3. liquidity_trade (流动性交易)

**当前**: `15.5 手`
**优化**: `15.5手 | 8张 | BUY`

**数据结构**:
```javascript
{
  trigger_value: 15.5,         // 累计手数
  details: { order_count: 8, direction: 'BUY', time_window: 60 }
}
```

**显示逻辑**: 累计手数 + 订单数 + 方向

---

### 4. scalping (刷单监控)

**当前**: `35s | 2.0手 | +$850` ✅ 已优化
**无需修改**

---

### 5. exposure_alert (敞口监控)

**当前**: `$12,500,000`
**优化**: `$12.5M | LONG USD`

**数据结构**:
```javascript
{
  trigger_value: 12500000,     // 敞口金额
  details: { direction: 'LONG', currency: 'USD', threshold: 10000000 }
}
```

**显示逻辑**: 敞口金额(简化格式) + 方向 + 货币

---

### 6. pricing_volatility (行情异常)

**当前**: `45s`
**优化**: 
- 停价: `45s | 停价`
- 波动: `85点 | 波动`

**数据结构**:
```javascript
// 停价
{
  trigger_value: 45,           // 停价时长(秒)
  details: { alert_subtype: 'PRICING', threshold: 30 }
}
// 波动
{
  trigger_value: 85,           // 波动点数
  details: { alert_subtype: 'VOLATILITY', change_points: 85 }
}
```

**显示逻辑**: 根据subtype区分显示

---

### 7. nop_limit (净头寸限额)

**当前**: `6,200`
**优化**: `62手 | LONG | $6,200`

**数据结构**:
```javascript
{
  trigger_value: 6200,         // USD价值
  details: { net_position: 62, direction: 'LONG', threshold: 5000 }
}
```

**显示逻辑**: 手数 + 方向 + USD价值

---

### 8. watch_list (观察名单)

**当前**: `5.0 手`
**优化**: `5.0手 | BUY | 开仓`

**数据结构**:
```javascript
{
  trigger_value: 5.0,          // 手数
  details: { action: 'OPEN_TRADE', direction: 'BUY', priority: 'HIGH' }
}
```

**显示逻辑**: 手数 + 方向 + 动作

---

### 9. reverse_positions (反向开仓)

**当前**: `3s`
**优化**: `3s | BUY→SELL | 2.0→2.5手`

**数据结构**:
```javascript
{
  trigger_value: 3,            // 间隔时间(秒)
  details: { 
    close_direction: 'BUY', 
    open_direction: 'SELL',
    close_lots: 2.0,
    open_lots: 2.5
  }
}
```

**显示逻辑**: 时间间隔 + 方向转换 + 手数变化

---

### 10. deposit_withdrawal (出入金)

**当前**: `$50,000`
**优化**: `$50,000 | 入金`

**数据结构**:
```javascript
{
  trigger_value: 50000,        // 金额
  details: { type: 'DEPOSIT', currency: 'USD' }
}
```

**显示逻辑**: 金额 + 类型(入金/出金)

---

## 三、实施代码

### alerts.js修改

```javascript
formatTriggerValue(alert) {
    var t = alert.rule_type;
    var v = alert.trigger_value;
    var d = alert.details || {};

    // 1. Large Trade (Lots)
    if (t === 'large_trade_lots') {
        var parts = [v + I18n.t('lot_unit')];
        if (d.direction) parts.push(d.direction);
        return parts.join(' | ');
    }

    // 2. Large Trade (USD)
    if (t === 'large_trade_usd') {
        var parts = ['$' + Utils.formatNumber(Math.abs(v))];
        if (d.lots) parts.push(d.lots + I18n.t('lot_unit'));
        return parts.join(' | ');
    }

    // 3. Liquidity Trade
    if (t === 'liquidity_trade') {
        var parts = [v + I18n.t('lot_unit')];
        if (d.order_count) parts.push(d.order_count + I18n.t('unit_orders'));
        if (d.direction) parts.push(d.direction);
        return parts.join(' | ');
    }

    // 4. Scalping (已优化)
    if (t === 'scalping') {
        var parts = [v + 's'];
        if (d.lots) parts.push(d.lots + I18n.t('lot_unit'));
        if (d.profit_usd !== undefined) {
            var profit = (d.profit_usd >= 0 ? '+$' : '-$') + Utils.formatNumber(Math.abs(d.profit_usd));
            parts.push(profit);
        }
        return parts.join(' | ');
    }

    // 5. Exposure Alert
    if (t === 'exposure_alert') {
        var parts = ['$' + Utils.formatNumber(Math.abs(v))];
        if (d.direction && d.currency) {
            parts.push(d.direction + ' ' + d.currency);
        }
        return parts.join(' | ');
    }

    // 6. Pricing & Volatility
    if (t === 'pricing_volatility') {
        if (d.alert_subtype === 'PRICING') {
            return v + 's | ' + I18n.t('pricing_stop');
        } else if (d.alert_subtype === 'VOLATILITY') {
            return d.change_points + I18n.t('unit_points') + ' | ' + I18n.t('volatility');
        }
        return v + 's';
    }

    // 7. NOP Limit
    if (t === 'nop_limit') {
        var parts = [];
        if (d.net_position) parts.push(d.net_position + I18n.t('lot_unit'));
        if (d.direction) parts.push(d.direction);
        parts.push('$' + Utils.formatNumber(v));
        return parts.join(' | ');
    }

    // 8. Watch List
    if (t === 'watch_list') {
        var parts = [v + ' ' + I18n.t('lot_unit')];
        if (d.direction) parts.push(d.direction);
        if (d.action) {
            var actionText = d.action === 'OPEN_TRADE' ? I18n.t('open_trade') : I18n.t('pending_order');
            parts.push(actionText);
        }
        return parts.join(' | ');
    }

    // 9. Reverse Positions
    if (t === 'reverse_positions') {
        var parts = [v + 's'];
        if (d.close_direction && d.open_direction) {
            parts.push(d.close_direction + '→' + d.open_direction);
        }
        if (d.close_lots && d.open_lots) {
            parts.push(d.close_lots + '→' + d.open_lots + I18n.t('lot_unit'));
        }
        return parts.join(' | ');
    }

    // 10. Deposit & Withdrawal
    if (t === 'deposit_withdrawal') {
        var parts = ['$' + Utils.formatNumber(Math.abs(v))];
        if (d.type) {
            var typeText = d.type === 'DEPOSIT' ? I18n.t('deposit') : I18n.t('withdrawal');
            parts.push(typeText);
        }
        return parts.join(' | ');
    }

    return v;
}
```

### rules.js修改

同样的逻辑应用到rules.js的formatTriggerValue函数。

---

## 四、需要的i18n新增

```javascript
// 中文
'pricing_stop': '停价',
'volatility': '波动',
'unit_points': '点',
'deposit': '入金',
'withdrawal': '出金',

// 英文
'pricing_stop': 'Stop Pricing',
'volatility': 'Volatility',
'unit_points': 'pts',
'deposit': 'Deposit',
'withdrawal': 'Withdrawal',
```

---

## 五、优化效果对比

| 规则类型 | 优化前 | 优化后 |
|---------|-------|-------|
| large_trade_lots | `8.5 手` | `8.5手 \| BUY` |
| large_trade_usd | `$125,000` | `$125,000 \| 2.5手` |
| liquidity_trade | `15.5 手` | `15.5手 \| 8张 \| BUY` |
| scalping | `35s` | `35s \| 2.0手 \| +$850` ✅ |
| exposure_alert | `$12,500,000` | `$12.5M \| LONG USD` |
| pricing_volatility | `45s` | `45s \| 停价` |
| nop_limit | `6,200` | `62手 \| LONG \| $6,200` |
| watch_list | `5.0 手` | `5.0手 \| BUY \| 开仓` |
| reverse_positions | `3s` | `3s \| BUY→SELL \| 2.0→2.5手` |
| deposit_withdrawal | `$50,000` | `$50,000 \| 入金` |

---

**状态**: 方案设计完成,待实施
